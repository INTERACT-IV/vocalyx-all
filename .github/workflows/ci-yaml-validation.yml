name: CI - YAML Validation

on:
  push:
    paths:
      - '*.yml'
      - '*.yaml'
      - '.github/workflows/**'
  pull_request:
    paths:
      - '*.yml'
      - '*.yaml'
      - '.github/workflows/**'
  workflow_dispatch:

jobs:
  validate-yaml:
    name: Validate YAML Files
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install yamllint
        run: |
          pip install yamllint

      - name: Validate docker-compose.yml
        run: |
          # Vérifier la syntaxe YAML et la structure Docker Compose
          docker compose config --quiet || exit 1
          echo "✅ docker-compose.yml est valide"

      - name: Validate all YAML files with yamllint
        run: |
          # Configuration yamllint permissive pour Docker Compose
          cat > .yamllint.yml << EOF
          extends: default
          rules:
            line-length: disable
            comments: disable
            document-start: disable
          EOF
          
          yamllint -c .yamllint.yml docker-compose.yml podman-compose.yml || true
          echo "✅ Validation YAML terminée"

      - name: Validate GitHub Actions workflows
        run: |
          # Valider les workflows GitHub Actions
          yamllint .github/workflows/*.yml || true
          echo "✅ Workflows GitHub Actions validés"
